/*!
 * Froala Instagram Plugin
 * Written by EvabioZ (evabioz@gmail.com)
 * Tested with Froala v2.0.5 (https://www.froala.com/wysiwyg-editor)
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,a){return void 0===a&&(a="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(a),a}:t(jQuery)}(function(t){"use strict";var e=/^(http|https):\/\/(instagr\.am|instagram\.com|www\.instagram\.com)\/p\/([^\/?]+)/;t.extend(t.FroalaEditor.POPUP_TEMPLATES,{"instagram.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),t.extend(t.FroalaEditor.DEFAULTS,{instagramEmbedVersion:7,instagramHelpText:"Paste a URL to generate code"}),t.merge(t.FroalaEditor.DEFAULTS.htmlAllowedAttrs,["onload"]),t.FroalaEditor.PLUGINS.instagram=function(a){function n(){var t="";a.opts.popupButtons&&a.opts.popupButtons.length>0&&(t+='<div class="fr-buttons">',t+=a.button.buildList(a.opts.popupButtons),t+="</div>");var e=0,n='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+a.id+'">';n+='<ul class="errorlist" style="display:none;"></ul>',a.opts.instagramHelpText&&(n+='<span class="fr-small-text">'+a.language.translate(a.opts.instagramHelpText)+"</span>"),n+='<div class="fr-input-line"><input name="href" type="text" placeholder="https://www.instagram.com/p/" tabIndex="'+ ++e+'"></div>',n+='<div class="fr-checkbox-line"><input name="captioned" type="checkbox" checked="checked" /><label>With Captioned</label></div>',n+='<div class="fr-action-buttons"><bfasdutton class="fr-command fr-submit" data-cmd="linkInstagramInsert" href="#" tabIndex="'+ ++e+'" type="button">'+a.language.translate("Insert")+"</bfasdutton></div></div>";var i={buttons:t,input_layer:n};return a.popups.create("instagram.insert",i)}function i(){var t=a.popups.get("instagram.insert");t||(t=n()),r(),a.popups.setContainer("instagram.insert",a.$tb);var e=a.$tb.find('.fr-command[data-cmd="instagram"]'),i=e.offset().left+e.outerWidth()/2,s=e.offset().top+(a.opts.toolbarBottom?10:e.outerHeight()-10);a.popups.show("instagram.insert",i,s,e.outerHeight())}function r(){var t=a.popups.get("instagram.insert"),e=t.find("ul.errorlist"),n=t.find('input[type="text"][name="href"]'),i=t.find('input[type="checkbox"][name="captioned"]');e.hide(),e.html(""),n.val("").trigger("change"),i.prop("checked",!0).trigger("checked")}function s(){a.popups.hide("instagram.insert")}function o(t){var e=a.popups.get("instagram.insert"),n=e.find("ul.errorlist"),i=e.find('input[type="text"][name="href"]');n.html("<li>"+t+"</li>").fadeIn(),i.one("keyup",function(){n.fadeOut()})}function p(n,i){a.events.focus(!0),a.selection.restore();var r=t.trim(n);if(""===r)return o("The URL is invalid. Please enter a valid URL."),!1;r=r.replace(/ /g,"%20");var s=r.match(e);return!s||s.length<4?(o("The URL is invalid. Please enter a valid URL."),!1):(t.ajax({url:"https://api.instagram.com/oembed/",dataType:"jsonp",data:{url:s[0]},success:function(t){var e=s[0]+(i?"/embed/captioned/?v=":"/embed/?v=")+a.opts.instagramEmbedVersion,n="$(window).on('message',$.proxy(function(e){var obj=$.parseJSON(e.originalEvent.data);if(this.contentWindow!==e.originalEvent.source)return;if(obj.type==='MEASURE')$(this).height(obj.details.height||500);},this))";a.html.insert('<iframe onload="'+n+'" class="fr-instagram" scrolling="no" frameborder="0" allowtransparency="true" src="'+e+'" style="border: 0; margin: 0; max-width: 658px; width: 100%; display: block; padding: 0; background: rgb(255, 255, 255);"></iframe><p><br></p>',!0);var r=a.$el.find(".fr-instagram");a.popups.hide("instagram.insert"),a.events.trigger("instagram.inserted",[r,s[0],s[3]])}}),!1)}function l(){var e=a.popups.get("instagram.insert"),n=e.find('input[type="text"][name="href"]').val(),i=e.find('input[type="checkbox"][name="captioned"]').is(":checked"),r=t(a.original_window).scrollTop();p(n,i),t(a.original_window).scrollTop(r)}return{showPopup:i,hidePopup:s,insertCallback:l,resetPopup:r}},t.FroalaEditor.DefineIcon("instagramBtnIcon",{NAME:"instagram"}),t.FroalaEditor.RegisterCommand("instagram",{title:"Insert Instagram",icon:"instagramBtnIcon",undo:!1,focus:!0,popup:!0,refreshOnCallback:!1,callback:function(){this.popups.isVisible("instagram.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("instagram.insert")):this.instagram.showPopup()}}),t.FroalaEditor.RegisterCommand("linkInstagramInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.instagram.insertCallback()}})});
