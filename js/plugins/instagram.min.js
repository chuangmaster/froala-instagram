/*!
 * Froala Instagram Plugin
 * Written by EvabioZ (evabioz@gmail.com)
 * Tested with Froala v2.0.5 (https://www.froala.com/wysiwyg-editor)
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,r){return void 0===r&&(r="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(r),r}:t(jQuery)}(function(t){"use strict";var e=/^(http|https):\/\/(instagr\.am|instagram\.com|www\.instagram\.com)\/p\/([^\/?]+)/;t.extend(t.FroalaEditor.POPUP_TEMPLATES,{"instagram.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),t.extend(t.FroalaEditor.DEFAULTS,{instagramEmbedVersion:7,instagramHelpText:"Paste a URL to generate code"}),t.FroalaEditor.PLUGINS.instagram=function(r){function a(){var t="";r.opts.popupButtons&&r.opts.popupButtons.length>0&&(t+='<div class="fr-buttons">',t+=r.button.buildList(r.opts.popupButtons),t+="</div>");var e=0,a='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+r.id+'">';a+='<ul class="errorlist" style="display:none;"></ul>',r.opts.instagramHelpText&&(a+='<span class="fr-small-text">'+r.language.translate(r.opts.instagramHelpText)+"</span>"),a+='<div class="fr-input-line"><input name="href" type="text" class="fr-link-attr" placeholder="https://www.instagram.com/p/" tabIndex="'+ ++e+'"></div>',a+='<div class="fr-action-buttons"><bfasdutton class="fr-command fr-submit" data-cmd="linkInstagramInsert" href="#" tabIndex="'+ ++e+'" type="button">'+r.language.translate("Insert")+"</bfasdutton></div></div>";var n={buttons:t,input_layer:a};return r.popups.create("instagram.insert",n)}function n(){var t=r.popups.get("instagram.insert");t||(t=a()),i(),r.popups.setContainer("instagram.insert",r.$tb);var e=r.$tb.find('.fr-command[data-cmd="instagram"]'),n=e.offset().left+e.outerWidth()/2,s=e.offset().top+(r.opts.toolbarBottom?10:e.outerHeight()-10);r.popups.show("instagram.insert",n,s,e.outerHeight())}function i(){var t=r.popups.get("instagram.insert"),e=t.find("ul.errorlist"),a=t.find('input.fr-link-attr[type="text"][name="href"]');e.hide(),e.html(""),a.val("").trigger("change")}function s(){r.popups.hide("instagram.insert")}function o(t){var e=r.popups.get("instagram.insert"),a=e.find("ul.errorlist"),n=e.find('input.fr-link-attr[type="text"][name="href"]');a.html("<li>"+t+"</li>").fadeIn(),n.one("keyup",function(){a.fadeOut()})}function l(a){r.events.focus(!0),r.selection.restore();var n=t.trim(a);if(""===n)return o("The URL is invalid. Please enter a valid URL."),!1;n=n.replace(/ /g,"%20");var i=n.match(e);return!i||i.length<4?(o("The URL is invalid. Please enter a valid URL."),!1):(t.ajax({url:"https://api.instagram.com/oembed/",dataType:"jsonp",data:{url:i[0]},success:function(t){var e=i[0]+"/embed/?v="+r.opts.instagramEmbedVersion,a=t.thumbnail_width,n=t.thumbnail_height,s="var src = {el: $(this), width: "+a+", height: "+n+"};$(window).resize(function(e){src.el.height((src.el.width() / src.width) * src.height + 90);}).trigger('resize')";r.html.insert('<iframe onload="'+s+'" class="fr-instagram" scrolling="no" frameborder="0" allowtransparency="true" src="'+e+'" style="border: 0; margin: 0; max-width: 658px; width: 100%; display: block; padding: 0; background: rgb(255, 255, 255);"></iframe><p><br></p>',!0);var o=r.$el.find(".fr-instagram");r.popups.hide("instagram.insert"),r.events.trigger("instagram.inserted",[o,i[0],i[3]])}}),!1)}function p(){var e=r.popups.get("instagram.insert"),a=e.find('input.fr-link-attr[type="text"][name="href"]').val(),n=t(r.original_window).scrollTop();l(a),t(r.original_window).scrollTop(n)}return{showPopup:n,hidePopup:s,insertCallback:p,resetPopup:i}},t.FroalaEditor.DefineIcon("instagramBtnIcon",{NAME:"instagram"}),t.FroalaEditor.RegisterCommand("instagram",{title:"Insert Instagram",icon:"instagramBtnIcon",undo:!1,focus:!0,popup:!0,refreshOnCallback:!1,callback:function(){this.popups.isVisible("instagram.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("instagram.insert")):this.instagram.showPopup()}}),t.FroalaEditor.RegisterCommand("linkInstagramInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.instagram.insertCallback()}})});
