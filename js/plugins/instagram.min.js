/*!
 * Froala Instagram Plugin
 * Written by EvabioZ (evabioz@gmail.com)
 * Tested with Froala v2.0.5 (https://www.froala.com/wysiwyg-editor)
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(jQuery)}(function(t){"use strict";var e=/^(http|https):\/\/(instagr\.am|instagram\.com|www\.instagram\.com)\/p\/([^\/?]+)/;t.extend(t.FroalaEditor.POPUP_TEMPLATES,{"instagram.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),t.extend(t.FroalaEditor.DEFAULTS,{instagramEmbedVersion:7,instagramHelpText:"Paste a URL to generate code"}),t.merge(t.FroalaEditor.DEFAULTS.htmlAllowedAttrs,["onload"]),t.FroalaEditor.PLUGINS.instagram=function(n){function a(){var t="";n.opts.popupButtons&&n.opts.popupButtons.length>0&&(t+='<div class="fr-buttons">',t+=n.button.buildList(n.opts.popupButtons),t+="</div>");var e=0,a='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+n.id+'">';a+='<ul class="errorlist" style="display:none;"></ul>',n.opts.instagramHelpText&&(a+='<span class="fr-small-text">'+n.language.translate(n.opts.instagramHelpText)+"</span>"),a+='<div class="fr-input-line"><input name="href" type="text" placeholder="https://www.instagram.com/p/" tabIndex="'+ ++e+'"></div>',a+='<div class="fr-checkbox-line"><input name="captioned" type="checkbox" checked="checked" /><label>With Captioned</label></div>',a+='<div class="fr-action-buttons"><button class="fr-command fr-submit" data-cmd="linkInstagramInsert" href="#" tabIndex="'+ ++e+'" type="button">'+n.language.translate("Insert")+"</button></div></div>";var i={buttons:t,input_layer:a};return n.popups.create("instagram.insert",i)}function i(){var t=n.popups.get("instagram.insert");t||(t=a()),r(),n.popups.setContainer("instagram.insert",n.$tb);var e=n.$tb.find('.fr-command[data-cmd="instagram"]'),i=e.offset().left+e.outerWidth()/2,s=e.offset().top+(n.opts.toolbarBottom?10:e.outerHeight()-10);n.popups.show("instagram.insert",i,s,e.outerHeight())}function r(){var t=n.popups.get("instagram.insert"),e=t.find("ul.errorlist"),a=t.find('input[type="text"][name="href"]'),i=t.find('input[type="checkbox"][name="captioned"]');e.hide(),e.html(""),a.val("").trigger("change"),i.prop("checked",!0).trigger("checked")}function s(){n.popups.hide("instagram.insert")}function o(t){var e=n.popups.get("instagram.insert"),a=e.find("ul.errorlist"),i=e.find('input[type="text"][name="href"]');a.html("<li>"+t+"</li>").fadeIn(),i.one("keyup",function(){a.fadeOut()})}function p(a,i){n.events.focus(!0),n.selection.restore();var r=t.trim(a);if(""===r)return o("The URL is invalid. Please enter a valid URL."),!1;r=r.replace(/ /g,"%20");var s=r.match(e);if(!s||s.length<4)return o("The URL is invalid. Please enter a valid URL."),!1;var a=s[0]+(i?"/embed/captioned/?v=":"/embed/?v=")+n.opts.instagramEmbedVersion,p="$(window).on('message',$.proxy(function(e){if(this.contentWindow!==e.originalEvent.source)return;var obj=$.parseJSON(e.originalEvent.data);if(obj.type==='MEASURE')$(this).height(obj.details.height||500);},this))";n.html.insert('<iframe onload="'+p+'" class="fr-instagram" scrolling="no" frameborder="0" allowtransparency="true" src="'+a+'" style="border: 0; margin: 0; max-width: 658px; width: 100%; display: block; padding: 0; background: rgb(255, 255, 255);"></iframe><p><br></p>',!0);var l=n.$el.find(".fr-instagram");return n.popups.hide("instagram.insert"),n.events.trigger("instagram.inserted",[l,s[0],s[3]]),!1}function l(){var e=n.popups.get("instagram.insert"),a=e.find('input[type="text"][name="href"]').val(),i=e.find('input[type="checkbox"][name="captioned"]').is(":checked"),r=t(n.original_window).scrollTop();p(a,i),t(n.original_window).scrollTop(r)}return{showPopup:i,hidePopup:s,insertCallback:l,resetPopup:r}},t.FroalaEditor.DefineIcon("instagramBtnIcon",{NAME:"instagram"}),t.FroalaEditor.RegisterCommand("instagram",{title:"Insert Instagram",icon:"instagramBtnIcon",undo:!1,focus:!0,popup:!0,refreshOnCallback:!1,callback:function(){this.popups.isVisible("instagram.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("instagram.insert")):this.instagram.showPopup()}}),t.FroalaEditor.RegisterCommand("linkInstagramInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.instagram.insertCallback()}})});
